- job-template:
    name: '{lab}-{mos}-del_vms'
    defaults: global
    builders:
      - ci-config-prep
      - shell: ssh 172.18.79.150 -l qa 'cd FuelDeployment/mos-components-ci/ && ./delete_vms.sh'
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true
      - trigger:
          project: '{lab}-{mos}-deploy'

- job-template:
    name: '{lab}-{mos}-deploy'
    defaults: global
    builders:
      - ci-config-prep
      - shell: ssh 172.18.79.150 -l qa 'cd FuelDeployment/mos-components-ci/ && ./launch.sh'
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true
      - trigger:
           project: '{lab}-prepare_cotroller'

- job-template:
    name: '{lab}-prepare_controller'
    defaults: global
    builders:
      - ci-config-prep
      - shell: |
              scp $WORKSPACE/qa-ci/slave-scripts/prepare_controller.sh qa@172.18.79.150:
              ssh 172.18.79.150 -l qa './prepare_controller.sh' 
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true

- job-template:
    name: '{lab}-prepare_images'
    defaults: global
    builders:
      - ci-config-prep
      - shell: "FUNCTION_PATH=$WORKSPACE/qa-ci/slave-scripts $WORKSPACE/qa-ci/slave-scripts/prepare_images.sh"
    publishers:
      - workspace-cleanup:
          clean-if:
            - success: true
            - not-built: true
            - aborted: true

- project:
    name: deploy_mos
    lab:
      - '151'
    mos:
      - '9.0'
    jobs:
      - '{lab}-{mos}-del_vms'
      - '{lab}-{mos}-deploy'
      - '{lab}-prepare_controller'
      - '{lab}-prepare_images'
